# 제네릭과 가변인수를 함께 쓸 때는 신중하라
> 가변인수와 제네릭은 궁합이 좋지 않다. 가변인수 기능은 배열을 노출하여 추상화가 완벽하지 못하고, 배열과 제네릭의 타입 규칙이 서로 다르기 때문이다. 제네릭 varargs 매개변수는 타입 안전하지는 않지만, 허용된다. 메서드에 제네릭(혹은 매개변수화된) varargs 매개변수를 사용하고자 한다면, 먼저 그 메서드가 타입 안전한지 확인한 다음 `@SafeVarargs` 애너테이션을 달아 사용하는 데 불편함이 없게끔 하자.

가변인수 메서드를 호출하면 가변인수를 담기위한 배열이 하나 만들어 지는데, 이 배열이 클라이언트로 노출되는 경우가 있다. 그 결과 varargs 매개변수에 제네릭이나 매개변수화 타입이 포함되면 알기 어려운 컴파일 경고가 발생한다.
```java
static void dangerous(List<String>... stringLists) {
    List<Integer> intList = List.of(42);

    Object[] objects = stringLists;
    objects[0] = intList; // 힙 오염 발생
    String s = stringLists[0].get(0); // ClassCastException
}
```


## 메서드가 안전한지 확인하는 방법?
1. 가변인수 메서드를 호출할 때 varargs 매개변수를 담는 제네릭 배열이 생성된다는 것을 기억하고
2. 메서드가 이 배열에 아무것도 저장하지 않고
3. 그 배열의 참조가 밖으로 노출되지 않는다면

타입 안전하다.